<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
           "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.douzone.DAO.DouzoneDAO">

	<select id="list_divcode" resultType="java.util.Map">
		SELECT
		div_code,div_name,div_type
		FROM codes
	</select>

	<select id="earner_list" resultType="java.util.Map">
		SELECT
		earner_code,earner_name,personal_no,is_native,div_code,div_name
		FROM
		earner
		WHERE worker_id = #{worker_id}
	</select>


	<select id="get_earner" resultType="com.douzone.entity.EarnerVO">
		SELECT *
		FROM earner
		WHERE
		earner_code = #{earner_code}
		AND worker_id = #{worker_id}
	</select>


	<insert id="earner_insert">
		INSERT INTO earner (earner_code, worker_id,
		earner_name, div_code, div_name,
		personal_no,is_native)
		VALUES(#{earner_code}, #{worker_id}, #{earner_name}, #{div_code},
		#{div_name},
		#{personal_no}, #{is_native})
	</insert>


	<update id="earner_update">
		UPDATE earner
		SET ${param_name}=#{param_value}
		WHERE
		earner_code = #{earner_code}
		AND worker_id = #{worker_id}
	</update>

	<delete id="earner_delete">
		<foreach collection="earner_codes" item="earner_code">
			DELETE FROM earner_tax
			WHERE earner_code = #{earner_code}
			AND worker_id = #{worker_id};

			DELETE FROM earner
			WHERE earner_code = #{earner_code}
			AND worker_id =
			#{worker_id};
		</foreach>
	</delete>







	<select id="earner_search" resultType="java.util.Map">
		SELECT earner_code, earner_name, is_native, personal_no, div_name, div_code
		FROM earner
		WHERE worker_id = #{worker_id}
		<if test="search_value != null and search_value != ''">
			AND (earner_code::text ILIKE '%' || #{search_value} || '%' OR earner_name
			ILIKE '%' || #{search_value} || '%' OR div_code ILIKE '%' ||
			#{search_value} || '%')
		</if>
	</select>

</mapper>



	